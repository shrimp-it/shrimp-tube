<!doctype html>
<html lang="de">

<head>
 <base target="_top">
     	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
	<meta name='mobile-web-app-capable' content='yes'> 
<meta name="robots" content="noindex">

 <title>WebApp</title>
 <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 120 120%22><text y=%22.9em%22 font-size=%2290%22>‚ú®</text></svg>"/>
  <link rel="stylesheet" href="scss/global.processed.css">
  <!--link rel="manifest" href="/manifest.json"-->
</head>

<body>

  <header style="height:1px; margin-top: 0; margin-bottom: 0;" class="main-header1"  >
  </header>

  <nav class="main-nav"  style="max-height:33px;" >
    <ul  style="max-height:30px;border-radius:5px;">
 
      <li class="active" style="max-height:21px;">
        <a href="#schedule" >
 
          <span>aiChat</span>
        </a>
      </li>     
     <li  style="max-height:28px;">
        <a href="#tickets2">
 
          <span>Notes</span>
        </a>
     </li>
    
     <li  style="max-height:28px;">
        <a href="#tickets">
 
          <span>aiTools</span>
        </a>
     </li>
  <li  style="max-height:28px;">
        <a href="#speakers">
 
          <span>usr</span>
        </a>
      </li>
   </ul>
  </nav>
 <!--button id="voicememo" style="background:black; font-size:1.2rem; border-radius:5px;" onclick="">üìå</button-->
<script>


</script>
  <main class="tabs">
    <div class="tab" id="speakers">  	
       <div id="sizeDisplay">Aktuelle Gr√∂√üe: wird geladen...</div> 
      <ul style="text-align: left;" class="speaker-list admin">
         <li style="text-align: left;">
         <div>    
      	<div style="margin-bottom:5px;margin-top:-25px;">
        	<details style="display: inline;" name="reqs">
          	<summary style="display: inline-block; margin-left:-5px;">üî∑<b>install:[<span  style="display: inline-block;" id="appmoarray0">0</span>,<span style="display: inline-block;" id="appmoarray1">0</span>] </b></summary>
          	<p id="appfunctions" style="display: block;margin-top:5px; margin-bottom:7px;">
          	 <label style="width:1.2rem;background:lightgreen; color:black" padding:5px;margin-bottom:3px;margin-bottom:1;px"><b>SpeechTxt static</b>
             	 <!-- checked="checked"-->
              <input type="checkbox" id="modulStaticlnk" style="height:1.1rem;width:1.1em;margin-top:3px;margin-bottom:1px;" onchange="let tpag = document.getElementById('contaskbing'); let zeval = document.querySelector('#appmoarray0');if(zeval.innerText == '1') {zeval.innerText='0';tpag.childNodes[1].classList.toggle('hide'); tpag.childNodes[7].classList.toggle('hide');tpag.childNodes[10].classList.toggle('hide');tpag.childNodes[12].classList.toggle('hide');} else {zeval.innerText='1';tpag.childNodes[1].classList.toggle('hide');tpag.childNodes[7].classList.toggle('hide');tpag.childNodes[10].classList.toggle('hide');tpag.childNodes[12].classList.toggle('hide');}">
            </label><br>
            <label style="width:1.2rem;background:grey; padding:8px;margin-bottom:5px"><b>no keys mobile</b>
              <input type="checkbox" id="modulNokeyb" style="height:1.1rem;width:1.1rem;margin-top:5px; background:green;" onchange="let zeval = document.querySelector('#appmoarray1');if(zeval.innerText == '1') {zeval.innerText='0'} else {zeval.innerText='1'}">
            </label>
          </p>
         </details>
        </div>
      <div style="margin-bottom:5px;">
        <details name="reqs">
          <summary><b>Permissions</b></summary>
          <p id="permissions">
            <button data-permission="clipboard-read">Read</button>
            <button data-permission="clipboard-write">Write</button>
            <button data-permission="microphone">Mikro</button>
            <button data-permission="geolocation">GPS</button>
          </p>
        </details>
      </div> 

        <div style="margin-bottom:5px;">
          <details name="reqs">
            <summary><b>Benutzer - API-Keys</b></summary>
            <p id="userinfo">
              <input type="text" id="username" style="width:95%; font-size: 0.9rem;" placeholder="short user name for local store key-part: mg">
              <input type="text" id="versionls" style="width:95%; font-size: 0.9rem;" placeholder="new version LS vers key-part: -v1">
                <!--   LS KEY THEN: mg-chatHistoryA100  > mgchatHistoryA100 > mg-chatHistoryA100 .>>.. mg-chatHistoryA100  -->
       <div class="flex items-center space-x-2">
        
            <select id="model-select" style="width:95%;font-size:0.9rem;" class="flex-1 p-2 rounded-lg border border-bolt bg-bolt-elements-prompt-background text-bolt-elements-textPrimary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-bolt-elements-focus transition-all">
              <option id="model-select-option" value="">...selected</option> 
              <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
               <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
               <option value="gemini-2.0-flash-lite">gemini-2.0-flash</option>   
  	<option value="gemini-2.5-pro">gemini-2.5-pro</option>
              <option value="Add More">Add More</option>
            </select>
          </div>
          <div class="flex items-center space-x-2">
          
            <select id="temperature-select" style="width:95%;font-size:0.9rem;" class="flex-1 p-2 rounded-lg border border-bolt bg-bolt-elements-prompt-background text-bolt-elements-textPrimary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-bolt-elements-focus transition-all">
              <option value="0.1">Low</option>
              <option value="0.3">Medium</option>
              <option value="0.5">High</option>
              <option value="0.7">Extreme</option>
              <option value="0.9">Ultra</option>
            </select>
          </div>
 
                <input type="text" id="gemiapikey" style="width:95%; font-size: 0.9rem;" placeholder="new Gemini API key"  value="XXX">
              <button style="width:95%; font-size: 0.9rem;" onclick="quickParam('keygemini'); console.log(API_KEY)" >apply</button>
          </p>
         </details>
         </div>

        </div>
        </li>
        
        <li style="font-size:1rem; padding-left:2px;margin-left:3px;">
        <div style="font-size:0.9rem; margin-bottom:3px;margin-top:-36px;">Farben:<button style="padding-top:0.2rem;padding-bottom:0.1rem; width:100%; min-width:60px;" onclick="document.querySelector('#theme-toggle-button').click(); if(this.textContent=='hell') {this.textContent='dunkel'} else {this.textContent='hell'}">hell</button> </div>
           <div style="font-size:0.9rem">Darstellung:<button style="padding-top:0.2rem;padding-bottom:0.1rem; width:100%; min-width:60px;" onclick="if(this.textContent=='mobil') {this.textContent='desktop'} else {this.textContent='mobil';document.body.style.backgroundColor='white'}">mobil</button> </div>
      <div style="font-size:0.9rem"><span id="webappversion"></span></div>
        </li>
        <li id="aifile-updown">        	  
        </li>   
    </ul>
    <ul style="display:none;" class="speaker-list module"> 
        <li>üë©üèª‚ÄçüíªVersion         
        </li>
        <li> üë¶üèø
          <span>Blake Badda</span>
        </li>
        <li>üë®‚Äçüç≥
          <span>Jimmy Saladcakes</span>
        </li>
        <li>üë®üèΩ‚Äçüé§
          <span>Abayomi Moscone</span>
        </li>
      </ul>
   </div>
  <div class="tab  active" id="schedule">
 
     
   <!--  <button class="close-button" style="border-radius: 100%; padding-top: 2px; padding-bottom: 2px; padding-left: 7px; padding-right: 7px; font-size:1.5rem; position: absolute; top:0; left: 92%; margin-top: -5px; opacity: 0.5; z-index: 99;" onclick="document.querySelector('.inpA').click();">‚úñ</button>-->
    <!-- fortsetzung aside auf _audio_web_di-->
    <script>
      function dictApp() {
        // Set up basic variables for app
        const record = document.querySelector(".record");
        const stop = document.querySelector(".stop");
        const soundClips = document.querySelector(".sound-clips");
        const canvas = document.querySelector(".visualizer");
        const mainSection = document.querySelector(".main-controls");
        // Disable stop button while not recording
        stop.disabled = true;
        // Visualiser setup - create web audio api context and canvas
        let audioCtx;
        const canvasCtx = canvas.getContext("2d");
        // Main block for doing the audio recording
        if (navigator.mediaDevices.getUserMedia) {
          console.log("The mediaDevices.getUserMedia() method is supported.");
          const constraints = {
            audio: true
          };
          let chunks = [];
          let onSuccess = function(stream) {
            const mediaRecorder = new MediaRecorder(stream);
            visualize(stream);
            record.onclick = function() {
              mediaRecorder.start();
              console.log(mediaRecorder.state);
              console.log("Recorder started.");
              record.style.background = "red";
              stop.disabled = false;
              record.disabled = true;
            };
            stop.onclick = function() {
              mediaRecorder.stop();
              console.log(mediaRecorder.state);
              console.log("Recorder stopped.");
              record.style.background = "";
              record.style.color = "";
              stop.disabled = true;
              record.disabled = false;
            };
            mediaRecorder.onstop = function(e) {
              console.log("Last data to read (after MediaRecorder.stop() called).");
              /*const clipName = prompt(
              "Enter a name for your sound clip?",
              "myclip-ai"
              );*/
              const clipName = "myclip-ai";
              const clipContainer = document.createElement("article");
              const clipLabel = document.createElement("p");
              const audio = document.createElement("audio");
              const deleteButton = document.createElement("button");
              const wavtoaiButton = document.createElement("button");
              const savewavButton = document.createElement("button");
              clipContainer.classList.add("clip");
              audio.setAttribute("controls", "");
              deleteButton.textContent = "Delete";
              deleteButton.className = "delete";
              wavtoaiButton.textContent = "StartAI";
              wavtoaiButton.className = "startwavai";
              savewavButton.textContent = "Save";
              savewavButton.className = "savewavai";
              if (clipName === null) {
                clipLabel.textContent = "My unnamed clip";
              } else {
                clipLabel.textContent = clipName;
              }
              clipContainer.appendChild(audio);
              clipContainer.appendChild(clipLabel);
              clipContainer.appendChild(deleteButton);
              clipContainer.appendChild(wavtoaiButton);
              clipContainer.appendChild(savewavButton);
              soundClips.appendChild(clipContainer);
              audio.controls = true;
              const blob = new Blob(chunks, {
                type: "audio/wav"
              });
              // mediaRecorder.mimeType });
              chunks = [];
              const audioURL = window.URL.createObjectURL(blob);
              audio.src = audioURL;
              console.log("recorder stopped");
              deleteButton.onclick = function(e) {
                e.target.closest(".clip").remove();
              };
              savewavButton.onclick = function(e) {
                const fname = e.target.closest(".clip").querySelector("p").innerText;
                let bloby = e.target.closest(".clip").querySelector("audio").srcObject;
                // alert(bloby);
                if (blob == null) {
                  // alert("no blob");
                  return;
                }
                var url = URL.createObjectURL(blob);
                var a = document.createElement("a");
                document.body.appendChild(a);
                a.style = "display: none";
                a.href = url;
                //alert("url");
                if (fname) {
                  a.download = fname + ".wav"
                } else {
                  a.download = "sample.wav";
                }
                a.click();
                window.URL.revokeObjectURL(url);
              };
              wavtoaiButton.onclick = function(e) {
                document.querySelectorAll(".startwavai").forEach(ele => {
                  ele.classList.remove("activewav")
                })
                e.target.classList.add("activewav");
                handleWavToAi(blob, clipLabel.textContent + ".wav");
              };
              clipLabel.onclick = function() {
                const existingName = clipLabel.textContent;
                const newClipName = prompt("Enter a new name for your sound clip?");
                if (newClipName === null) {
                  clipLabel.textContent = existingName;
                } else {
                  clipLabel.textContent = newClipName;
                }
              };
            };
            mediaRecorder.ondataavailable = function(e) {
              chunks.push(e.data);
            };
          };
          let onError = function(err) {
            console.log("The following error occured: " + err);
          };
          navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);
        } else {
          console.log("MediaDevices.getUserMedia() not supported on your browser!");
        }

        function visualize(stream) {
          if (!audioCtx) {
            audioCtx = new AudioContext();
          }
          const source = audioCtx.createMediaStreamSource(stream);
          const bufferLength = 2048;
          const analyser = audioCtx.createAnalyser();
          analyser.fftSize = bufferLength;
          const dataArray = new Uint8Array(bufferLength);
          source.connect(analyser);
          draw();

          function draw() {
            const WIDTH = canvas.width;
            const HEIGHT = canvas.height;
            requestAnimationFrame(draw);
            analyser.getByteTimeDomainData(dataArray);
            canvasCtx.fillStyle = "rgb(200, 200, 200)";
            canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);
            canvasCtx.lineWidth = 2;
            canvasCtx.strokeStyle = "rgb(0, 0, 0)";
            canvasCtx.beginPath();
            let sliceWidth = (WIDTH * 1.0) / bufferLength;
            let x = 0;
            for (let i = 0; i < bufferLength; i++) {
              let v = dataArray[i] / 128.0;
              let y = (v * HEIGHT) / 2;
              if (i === 0) {
                canvasCtx.moveTo(x, y);
              } else {
                canvasCtx.lineTo(x, y);
              }
              x += sliceWidth;
            }
            canvasCtx.lineTo(canvas.width, canvas.height / 2);
            canvasCtx.stroke();
          }
        }
        window.onresize = function() {
          canvas.width = mainSection.offsetWidth;
        };
        window.onresize();
      }
      const convertBlobToBase64 = (blob) => {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onerror = reject;
          reader.onload = () => {
            resolve(reader.result.split(',')[1]); // Extrahiere den Base64-Teil
          };
          reader.readAsDataURL(blob);
        });
      };

      // NEW: Central function to handle any media upload to AI
      const recApp = async (blob, filename, mimeType) => {
        if (document.body.classList.contains('bot-responding')) {
          // alert("Bitte warte, bis die vorherige Anfrage abgeschlossen ist.");
          return;
        }
        document.body.classList.add('chats-active', 'bot-responding');

        const messageForAI = "bitte fuehre die Sprach-Befehle aus die im sound des files orhanden sein muessten. Falls keine sprach-befehle erkannt werden, so interpretiere und beschreibe den inhalt des hochgeladenen medien-files, soweit es dir m√∂glich ist. oder antworte mit. Nicht verstanden bitte erneut versuchen";

        // Display user message about the upload
        const userMsgHTML = `<p class="message-text">${messageForAI}</p>`;
        const userMsgDiv = createMessageElement(userMsgHTML, 'user-message');
        chatsContainer.appendChild(userMsgDiv);
        scrollToBottom();
        saveChatHistory(); // Save chat history before AI response

        try {
          const base64Media = await convertBlobToBase64(blob);
          userData.file = {
            fileName: filename,
            data: base64Media,
            mime_type: mimeType,
            isImage: mimeType.startsWith('image/') // true for image, false for audio/video
          };
          userData.message = messageForAI; // Set the specific message for AI

          // Display "Just a sec..." bot message
          setTimeout(() => {
            const botMessageHTML = `<div class='message-maindiv'><span class='avatar' style='font-size:larger;'>‚ú®</span><code class='message-text'>Just a sec...</code></div>`;
            const botMessageDiv = createMessageElement(botMessageHTML, 'bot-message', 'loading');
            chatsContainer.appendChild(botMessageDiv);
            scrollToBottom();
            generateResponse(botMessageDiv);
          }, 600);
        } catch (error) {
          console.error("Fehler beim Konvertieren der Mediendatei:", error);
          document.body.classList.remove('bot-responding');
          // alert("Fehler beim Senden der Mediendatei.");
        }
      };

      // Make recApp globally accessible so shrimp-recorder.js and other modules can call it
      window.recApp = recApp;

      // Modify handleWavToAi to use recApp for consistency with other media uploads
      const handleWavToAi = async (blob, filename) => {
        // Assume audio/wav for handleWavToAi context
        await recApp(blob, filename, 'audio/wav'); 
      };
    </script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style id="gemini2aichatbotStyle">
      :root {
        --text-color: #edf3ff;
        --subheading-color: #97a7ca;
        --placeholder-color: #c3cdde;
        --primary-color: #101623;
        --secondary-color: #283045;
        --secondary-hover-color: #333e58;
        --scrollbar-color: #626a7f;
      }

      * {
        margin: 0px;
        padding: 0px;
        box-sizing: border-box;
        font-family: 'Poppins', sans-serif;
      }

      body {
        background-color: var(--primary-color);
        color: var(--text-color);
        margin: 0px;
        padding: 0px;
      }

      * textarea {
        width: 96%;
        min-height: 50px;
      }

      * .hide {
        display: none;
      }

      * show {
        display: flex
      }

      body.light-theme {
        --text-color: #090c13;
        --subheading-color: #7b8cae;
        --placeholder-color: #606982;
        --primary-color: #f3f7ff;
        --secondary-color: #dce6f9;
        --secondary-hover-color: #d2ddf2;
        --scrollbar-color: #a2aac2;
      }

      .container {
        overflow-y: auto;
        padding: 12px 0px 10px;
        height: calc(100vh - 127px);
        scrollbar-color: var(--scrollbar-color) transparent;
      }

      .container :where(.application-header,
        .suggestions,
        .message,
        .prompt-wrapper) {
        position: relative;
        margin: 0px auto;
        padding: 0px 10px;
        width: 100%;
        max-width: 990px;
      }

      .container .application-header {
        margin-top: 3vh;
      }

      .container .application-header .heading {
        width: fit-content;
        font-size: 1.1rem;
        background-image: linear-gradient(to right, #1d7efd, #8f6fff);
        text-transform: capitalize;
        -webkit-text-fill-color: transparent;
        -webkit-background-clip: text;
        background-clip: text;
      }

      .container .application-header .sub-heading {
        font-size: 1.1rem;
        margin-top: -5px;
        color: var(--subheading-color);
        text-transform: capitalize;
      }

      .container .suggestions {
        width: 100%;
        list-style: none;
        gap: 15px;
        margin-top: 4.5vh;
        overflow-x: auto;
        columns: 2;
        -webkit-columns: 2;
        -moz-columns: 2;
        scroll-snap-type: x mandatory;
        scrollbar-width: none;
      }

      body.chats-active .container :where(.application-header,
        .suggestions) {
        display: none;
      }

      .container .suggestions .suggestions-item {
        cursor: pointer;
        padding: 13px;
        width: 100%;
        display: flex;
        flex-shrink: 0;
        flex-direction: column;
        align-items: flex-end;
        justify-content: space-between;
        scroll-snap-align: center;
        margin-bottom: 5px;
        text-transform: capitalize;
        border-radius: 12px;
        background-color: var(--secondary-color);
        transition: 0.3s ease;
      }

      .container .suggestions .suggestions-item:hover {
        background-color: var(--secondary-hover-color);
      }

      .container .suggestions .suggestions-item .text {
        font-size: 1rem;
      }

      .container .suggestions .suggestions-item .icon {
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        align-self: flex-end;
        justify-content: center;
        font-size: 1.4rem;
        margin-top: 15px;
        border-radius: 50%;
        background-color: var(--primary-color);
        color: #1d7efd;
      }

      .container .suggestions .suggestions-item:nth-child(2) .icon {
        color: #28a745;
      }

      .container .suggestions .suggestions-item:nth-child(3) .icon {
        color: #ffc107;
      }

      .container .suggestions .suggestions-item:nth-child(4) .icon {
        color: #6f42c1;
      }

      .container .chats-container {
        display: flex;
        gap: 20px;
        flex-direction: column;
        height: 100%;
      }

      .container .chats-container .message {
        display: flex;
        gap: 11px;
        align-items: center;
      }

      .container .chats-container .message .avatar {
        cursor: pointer;
        position: absolute;
        top: -10px;
        left: -10px;
        width: 40px;
        height: 40px;
        font-size: 1.6rem;
        align-self: flex-start;
        border-radius: 50%;
        padding: 0;
        margin-right: 17px;
        background: transparent;
        border: 0;
        // background: var(--secondary-color);
        //border: 1px solid var(--secondary-hover-color);
      }

      .container .chats-container .message .xavatar2 {
        position: absolute;
        bottom: 0;
        cursor: pointer;
        left: 0;
        width: 20px;
        height: 20px;
        flex-shrink: 0;
        align-self: flex-start;
        border-radius: 50%;
        padding: 1px;
        margin-top: 3px;
        margin-right: -7px;
        background: transparent;
        opacity: 0.5;
        border: 0;
        //border: 1px solid var(--secondary-hover-color);
      }

      .container .chats-container .message .xavatar {
        cursor: pointer;
        position: absolute;
        bottom: 0;
        left: 15px;
        width: 20px;
        height: 20px;
        flex-shrink: 0;
        align-self: flex-start;
        border-radius: 50%;
        padding: 1px;
        margin-top: 3px;
        margin-right: -7px;
        background: transparent;
        opacity: 0.5;
        border: 0;
        // border: 1px solid var(--secondary-hover-color);
      }

      .showme {
        display: block;
      }

      .showme-not {
        display: none;
      }

      .container .chats-container .message.loading .avatar {
        animation: rotate 3s linear infinite;
      }

      @keyframes rotate {
        100% {
          transform: rotate(360deg);
        }
      }

      .container .chats-container .message .message-text {
        padding: 3px 16px;
        word-wrap: break-word;
        white-space: pre-line;
      }

      .message-maindiv {
        position: relative;
        padding: 12px 16px;
        min-width: 80%;
        width: 380px;
        max-width: 100%;
        background: var(--secondary-color);
        border-radius: 13px 13px 3px 13px;
      }

      .container .chats-container .bot-message {
        min-width: 88%;
        max-width: 94%;
        margin-left: -1px;
        margin-right: 4%;
      }

      .container .chats-container .user-message {
        flex-direction: column;
        align-items: flex-end;
        margin-left: 10%;
        margin-right: 2%;
        width: 81%;
font-size:0.9rem;
      }

      .container .chats-container .user-message .message-text {
        padding: 4px 6px;
        max-width: 100%;
        background: var(--secondary-color);
        border-radius: 13px 13px 3px 13px;
        font-size: 0.9rem;
      }

      .container .chats-container .user-message .image-attachment {
        margin-top: -7px;
 
        border-radius: 13px 3px 13px 13px;
      }

      .container chats-container .user-message .file-attachment {
        display: flex;
        align-items: center;
        gap: 1px;
        margin-top: -7px;
        padding: 10px;
        border-radius: 13px 3px 13px 13px;
        background-color: var(--secondary-color);
      }

      .container .chats-container .user-message .file-attachment span {
        color: #1d7efd;
      }

      .container .prompt-container {
        position: absolute;
        left: 0%;
        bottom: 1%;
        width: 100%;
        padding: 4px 2px;
        margin-bottom: 1%;
        background-color: var(--primary-color);
      }

      .container .prompt-container.mobile{
        position: absolute;
        left: 0%;
        bottom: 90%;
        width: 100%;
        padding: 4px 2px;
        margin-bottom: 1%;
        background-color: var(--primary-color);
      }

      .prompt-container :where(.prompt-wrapper,
        .prompt-form,
        .prompt-actions) {
        display: flex;
        align-items: center;
        gap: 1px;
        height: 30px;
      }

      .prompt-container .prompt-form {
        height: 100%;
        width: 100%;
        border-radius: 120px;
        background-color: var(--secondary-color);
      }

      .prompt-form .prompt-input {
        width:  100%;
        height: 100%;
        background: none;
        color: var(--text-color);
        border: none;
        outline: none;
        font-size: 1rem;
        padding-left: 5px;
      }

      .prompt-form .prompt-input::placeholder {
        color: var(--placeholder-color);
      }

      .prompt-wrapper button {
        width: 53px;
        height: 100%;
        flex-shrink: 0;
        cursor: pointer;
        font-size: 1.2rem;
margin-left:1px;
margin-right:1px;
        border: none;
        border-radius: 50%;
        background-color: var(--secondary-color);
        color: var(--text-color);
        transition: 0.3s ease;
      }

      .prompt-wrapper :is(button:hover,
        #cancel-file-button,
        .file-icon) {
        background-color: var(--secondary-hover-color);
      }

      .prompt-form .prompt-actions {
        gap: 3px;
        margin-right: 7px;
      }

      .prompt-wrapper .prompt-form :where(.file-upload-wrapper,
        button,
        img) {
        position: relative;
        height: 35px;
        width: 35px;
      }

      .prompt-form .file-upload-wrapper :where(button,
        img) {
        display: none;
        border-radius: 50%;
        object-fit: cover;
        position: absolute;
      }

      .prompt-form .file-upload-wrapper.active #add-file-button {
        display: none;
      }

      .prompt-form .file-upload-wrapper #add-file-button,
      .prompt-form .file-upload-wrapper.active.image-attached img,
      .prompt-form .file-upload-wrapper.active.file-attached .file-icon,
      .prompt-form .file-upload-wrapper.active:hover #cancel-file-button {
        display: block;
      }

      .prompt-form :is(#stop-response-button:hover,
        #cancel-file-button) {
        color: #d62939;
      }

      .prompt-wrapper .prompt-form .file-icon {
        color: #1d7efd;
      }

      .prompt-form #stop-response-button,
      body.bot-responding .prompt-form .file-upload-wrapper {
        display: none;
      }

      body.bot-responding .prompt-form #stop-response-button {
        display: block;
      }

      .prompt-container .disclaimer-text {
        font-size: 0.9rem;
        text-align: center;
        padding: 6px 8px 0px;
        color: var(--placeholder-color);
      }

      @media only screen and (max-width:668px) {
        .container {
          padding: 10px 0px 10px;
        }

        .application-header :is(.heading,
          .sub-heading) {
          font-size: 2rem;
          line-height: 1.4;
        }

        .application-header .sub-heading {
          font-size: 1.7rem;
        }

        .container .chats-container {
          gap: 12px;
          margin-bottom: 2%;
        }

        .chats-container .bot-message {
          margin: 4px auto;
        }

        .prompt-container :where(.prompt-wrapper,
          .prompt-form,
          .prompt-actions) {
          gap: 2px;
          height: 43px;
        }

        .prompt-container button {
          width: 43px;
        }

        .prompt-form :is(.file-upload-wrapper,
          button,
          img) {
          height: 35px;
          width: 35px;
        }

        .prompt-form .prompt-input {
          padding-left: 10px;
        }

        .prompt-form .file-upload-wrapper.active #cancel-file-button {
          opacity: 0;
        }

        .prompt-wrapper.hide-controls :where(#theme-toggle-button,
          #delete-chats-button) {
          display: none;
        }
      }

      .copy-code-button {
        /* Stil nach Bedarf anpassen */
        color: #1d7efd;
        /* Beispiel: Blaue Farbe */
        /* Weitere Stile */
      }
    </style>

<div class="container section" id="gemini2aichatbotHtml" style="margin-left: 0;margin-right: 0;width:103%;">
      <header class="application-header">
        <!--h3 class="heading">Gemini 2.0-Flash</h3-->
        <!--h4 class="sub-heading">chatte mit AI@Google</h4-->
      </header>
      <ul style="columns: 2; -webkit-columns: 2; -moz-columns: 2;" class="suggestions">
        <li class="suggestions-item">
          <p class="text">Erstelle eine kleine HTML-App mit js und css</p>
          <span class="icon material-symbols-rounded">draw</span>
        </li>
        <li class="suggestions-item">
          <p class="text">Beantworte meine n√§chsten Prompts nur mit dem von mir angeforderten ergebnis ohne weitere erkl√§rung oder text. Wenn Du bereit bist, antworte mit: "erkl√§rungen: /off - bereit"</p>
          <span class="icon material-symbols-rounded">lightbulb</span>
        </li>
        <li class="suggestions-item">
          <p class="text">Beantworte meine n√§chsten Prompts mit dem von mir angeforderten Ergebnis und einer kurzen Erkl√§rung mit der √úberschrift 'Erkl√§rung' am Ende des textes. Wenn Du bereit bist, antworte mit: "erkl√§rungen: /on - bereit</p>
          <span class="icon material-symbols-rounded">explore</span>
        </li>
        <li class="suggestions-item">
          <p class="text">create a react js component for the simple todo list app.</p>
          <span class="icon material-symbols-rounded">code_blocks</span>
        </li>
      </ul>
      <div class="chats-container"></div>
      <div class="prompt-container">

        <div class="prompt-wrapper">
          <form action="#" class="prompt-form">
            <input type="text" placeholder="Ask Gemini" class="prompt-input" required />
            <div class="prompt-actions">
              <div class="file-upload-wrapper">
                <img src="#" alt="filebild" class="file-preview" />
                <input id="file-input" type="file" accept="image/*,.pdf,.txt,.csv,.mp3" hidden />
                <button type="button" class="file-icon material-symbols-rounded">description</button>
                <button id="cancel-file-button" type="button" class="material-symbols-rounded">close</button>
                <button id="add-file-button" type="button" class="material-symbols-rounded">attach_file</button>
              </div>
              <button id="stop-response-button" type="button" class="material-symbols-rounded">stop_circle</button>
              <button id="send-prompt-button" class="material-symbols-rounded">arrow_upward</button>
            </div>
          </form>
          <button id="theme-toggle-button" class="material-symbols-rounded prompt-tools">light_mode</button>
          <button id="delete-chats-button" class="material-symbols-rounded prompt-tools">delete</button>
          <button id="fulls-chats-button" onclick="fullx()" class="material-symbols-rounded prompt-tools" style="font-size:0.8rem;">üíæ</button>
          <button id="fulls-bomodal-button" onclick="shrimpRecorder.init();" class="material-symbols-rounded prompt-tools" style="font-size:0.8rem;">üí¶</button>
        </div>

      </div> <input type="button" style="position: absolute; bottom:13%;left:3px;font-size:1.2rem;border:0; border-radius: 100%; padding:3px;background: yellow" value="‚ú®" onclick="if (this.style.background == 'yellow') {document.querySelector('.prompt-wrapper').style.display='none';this.style.background = 'orange';document.querySelector('.prompt-container').style.background='transparent';return};if (this.style.background == 'orange') {document.querySelector('.prompt-wrapper').style.display='block';this.style.background = 'red';document.querySelector('.prompt-container').style.background='';return} if (this.style.background == 'red') {document.querySelector('.prompt-wrapper').style.display='none';this.style.background ='green'; document.querySelectorAll('.prompt-tools').forEach((elem) => {elem.classList.toggle('hide') }); return} else {document.querySelector('.prompt-wrapper').style.display='';this.style.background = 'yellow'; document.querySelector('.prompt-container').style.background=''}">
    </div>
    <!--nur in verbindung mit _audio_web_ditv2-->
    <script src="js/userconfirmdelete-module.js" id="userconfirmdelete-module"></script>
    <script id="gemini2aichatbotScript">
      const fullx = (ele) => {
        ele = ele || document.documentElement ;
        if (document.fullscreenElement) {
          document.exitFullscreen().then(() => console.log("Document Exited from Full screen mode")).catch((err) => console.error(err))
        } else {
          ele.requestFullscreen();
        }
      }
      const container = document.querySelector('.container');
      const chatsContainer = document.querySelector('.chats-container');
      const promptForm = document.querySelector('.prompt-form');
      const promptInput = promptForm.querySelector('.prompt-input');
      const fileInput = promptForm.querySelector('#file-input');
      const fileUploadWrapper = promptForm.querySelector('.file-upload-wrapper');
      const themeToggleButton = document.querySelector('#theme-toggle-button');
      var API_KEY = 'no-key'; // siehe signal notiz
      var API_MODEL = 'gemini-2.0-flash';
      var API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${API_KEY}`;
    // generativelanguage/apiv1beta/
      const chatHistory = [];
      const userData = {
        message: "",
        file: {}
      };
      const isLightTheme = localStorage.getItem('themeColor') === 'light_mode';
      let typingInterval;
      let controller;
      document.body.classList.toggle("light-theme", isLightTheme);
      themeToggleButton.textContent = isLightTheme ? 'dark_mode' : 'light_mode';
      const STORAGE_KEY = document.querySelector('#username').value+'-'+document.querySelector('#versionls').value  //'document.querySelector('#versionls').value / chatHistoryA100';  Local Storage Key
      const createMessageElement = (content, ...classes) => {
        const div = document.createElement('div');
        div.classList.add('message', ...classes);
        div.innerHTML = content;
        return div;
      };
      const scrollToBottom = () => container.scrollTo({
        top: container.scrollHeight,
        behavior: 'smooth'
      });
      const addCopyButton = (element, code) => {
        const copyButton = document.createElement('span');
        copyButton.classList.add('material-symbols-rounded', 'copy-code-button');
        copyButton.textContent = 'content_copy';
        copyButton.style.cursor = 'pointer';
        copyButton.style.position = 'absolute';
        copyButton.style.right= '0';
        copyButton.style.bottom = '1%';
        copyButton.style.userSelect = 'none'; // Verhindert das Markieren des Icons
        copyButton.title = 'Code kopieren'; // Tooltip
        copyButton.addEventListener('click', () => {
          navigator.clipboard.writeText(code).then(() => {
            // Optionale R√ºckmeldung f√ºr den Benutzer (z.B. Tooltip √§ndern)
            copyButton.textContent = 'done';
            setTimeout(() => {
              copyButton.textContent = 'content_copy';
            }, 1500);
          }).catch(err => {
            console.error('Fehler beim Kopieren des Codes: ', err);
            copyButton.textContent = 'error'; // Fehler-Icon
          });
        });
        element.appendChild(copyButton);
      };
      const typingEffect = (text, textElement, botMessageDiv) => {
        textElement.textContent = "";
        const words = text.split(" ");
        let wordIndex = 0;
        typingInterval = setInterval(() => {
          if (wordIndex < words.length) {
            textElement.textContent += (wordIndex === 0 ? "" : " ") + words[wordIndex++];
            scrollToBottom();
          } else {
            clearInterval(typingInterval);
            botMessageDiv.classList.remove('loading');
            document.body.classList.remove('bot-responding');
            // Code Kopierfunktion hinzuf√ºgen
            if (text.startsWith('```html')) {
              const code = text.substring(7, text.length).split('```html')[0].trim(); 
// Entfernt 
              console.log('mit html haltestelle \n code' );
              addCopyButton(textElement.parentElement, code);
            } else {
             // wenn kein html in antwort dann ganze antwort kopieren
              const code = text.trim(); // Entfernt
              console.log('kein html  \n code');
              addCopyButton(textElement.parentElement, code);
          }
}
        }, 5);
        //setIntervall 40 - 10 -
      };
      const generateResponse = async (botMessageDiv) => {
        const textElement = botMessageDiv.querySelector('.message-text');
        controller = new AbortController();
        chatHistory.push({
          role: 'user',
          parts: [{
            text: userData.message
          }, ...(userData.file.data ? [{
            inline_data: (({
              fileName,
              isImage,
              ...rest
            }) => rest)(userData.file)
          }] : [])],
        });
        try {

          API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${API_KEY}`;
          const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              contents: chatHistory
            }),
            signal: controller.signal,
          });
          const data = await response.json();
          if (!response.ok) throw new Error(data.error.message);
          const responseText = data.candidates[0].content.parts[0].text.replace(/\*\*([^*]+)\*\*/g, '$1').trim();
          typingEffect(responseText, textElement, botMessageDiv);
          chatHistory.push({
            role: 'model',
            parts: [{
              text: responseText
            }]
          });
          saveChatHistory(); // Speichern nach erfolgreicher Antwort
        } catch (error) {
          textElement.textContent = error.name === 'AbortError' ? 'Response generation stopped.' : error.message;
          textElement.style.color = '#d62939';
          botMessageDiv.classList.remove('loading');
          document.body.classList.remove('bot-responding');
          scrollToBottom();
        } finally {
          userData.file = {};
        }
      };
      const handleFormSubmit = (event) => {
        event.preventDefault();
        const userMessage = promptInput.value.trim();
        if (!userMessage || document.body.classList.contains('bot-responding')) return;
        userData.message = userMessage;
        promptInput.value = "";
        document.body.classList.add('chats-active', 'bot-responding');
        fileUploadWrapper.classList.remove('file-attached', 'img-attached', 'active');
        const userMsgHTML = `
        <p class="message-text"></p>
        ${userData.file.data ? (userData.file.isImage ? `<img src="data:${userData.file.mime_type};base64,${userData.file.data}" class="image-attachment" />` : `<p class="file-attachment"><span class="material-symbols-rounded">description</span>${userData.file.fileName}</p>`) : ""}
        `;
        const userMsgDiv = createMessageElement(userMsgHTML, 'user-message');
        userMsgDiv.querySelector('.message-text').textContent = userData.message; // x
        chatsContainer.appendChild(userMsgDiv);
        scrollToBottom();
        saveChatHistory();
        setTimeout(() => {
          const botMessageHTML = `<div class='message-maindiv'><span class='avatar' style='font-size:larger;' onclick='addCopyButton(this.parentElement,this.parentElement.querySelector(".message-text").innerText)'>‚ú®</span><code class='message-text'>Just a sec...</code></div>`;
          const botMessageDiv = createMessageElement(botMessageHTML, 'bot-message', 'loading');
          chatsContainer.appendChild(botMessageDiv);
          scrollToBottom();
          generateResponse(botMessageDiv);
        }, 600);
      };
      const saveChatHistory = () => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(chatHistory));
      };
      const loadChatHistory = () => {
        const storedHistory = localStorage.getItem(STORAGE_KEY);
        if (storedHistory) {
          const parsedHistory = JSON.parse(storedHistory);
          // Stelle sicher, dass die geladenen Daten ein Array sind, bevor du sie verwendest.
          if (Array.isArray(parsedHistory)) {
            chatHistory.push(...parsedHistory);
            // Rendere den geladenen Chat-Verlauf
            chatHistory.forEach(chatItem => {
              if (chatItem.role === 'user') {
                const userMsgHTML = `<div class='message-text'>${chatItem.parts[0].text}</div><button style='position:absolute;right:4%;top:-15px;padding:1px; background: transparent;' class='remove-message-history' onclick='this.parentElement.remove();saveChatHistory();'>‚ùå</button>`;
                const userMsgDiv = createMessageElement(userMsgHTML, 'user-message');
                chatsContainer.appendChild(userMsgDiv);
              } else if (chatItem.role === 'model') {
                const botMessageHTML = `<div class='message-maindiv' name='message-maindiv'><button style='position:absolute;right:1%;top:-5px;padding:1px; background: transparent;' class='remove-message-history' onclick='this.parentElement.remove();saveChatHistory();'>‚ùå</button><button class='avatar' onclick='addCopyButton(this.parentElement, this.parentElement.querySelector(".message-text").value); '>‚ú®</button><textarea class='message-text'>${chatItem.parts[0].text}</textarea><button class='xavatar' onclick='let old=this.parentElement.innerHTML; this.parentElement.innerHTML=old.toString().replace("<textarea ", "<div ").replace("</textarea>","</div>");'>üîª</button><button class='xavatar2' onclick='let old=this.parentElement.innerHTML; this.parentElement.innerHTML=old.toString().replace("<div ", "<textarea ").replace("</div>","</textarea>")'>üî∫</button><button class="savenotebtn" style="position: absolute; left:91%; top:10px; border-radius:100%; background:transparent;" onclick="try {document.getElementById('note-textarea').value = (this.closest('.message-maindiv').querySelector('textarea').value);document.getElementById('save-note-btn').click()} catch(f) {}">üíæ</button></div>`;
                const botMessageDiv = createMessageElement(botMessageHTML, 'bot-message');
                chatsContainer.appendChild(botMessageDiv);
              }
            });
            // Chats aktiv setzen
            if (chatHistory.length > 0) {
              document.body.classList.add('chats-active');
            }
            scrollToBottom();
          } else {
            console.error("Ung√ºltige Daten im Local Storage. Erwarte ein Array.");
          }
        }
      };
    
 // L√∂sche den Local Storage wenn die Chats gel√∂scht werden:
    document.querySelector('#delete-chats-button').addEventListener('click', (e) => {      
     userconfirmDelete(() => {
        	chatHistory.length = 0;
        	chatsContainer.innerHTML = "";
        	document.body.classList.remove('chats-active', 'bot-responding');
        	localStorage.removeItem(STORAGE_KEY);
           }, "M√∂chtest du den Chat-Verlauf wirklich l√∂schen?");
      });

   promptForm.addEventListener('submit', handleFormSubmit);

    fileInput.addEventListener('change', () => {
        const file = fileInput.files[0];
        if (!file) return;
        const isImage = file.type.startsWith('image/');
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = (event) => {
          fileInput.value = "";
          const base64String = event.target.result.split(',')[1];
          fileUploadWrapper.querySelector('.file-preview').src = event.target.result;
          fileUploadWrapper.classList.add('active', isImage ? 'image-attached' : 'file-attached');
          userData.file = {
            fileName: file.name,
            data: base64String,
            mime_type: file.type,
            isImage
          };
        };
      });
      document.querySelector('#cancel-file-button').addEventListener('click', () => {
        userData.file = {};
        fileUploadWrapper.classList.remove('file-attached', 'image-attached', 'active');
      });
      document.querySelector('#stop-response-button').addEventListener('click', () => {
        controller?.abort();
        userData.file = {};
        clearInterval(typingInterval);
        chatsContainer.querySelector('.bot-message.loading').classList.remove('loading');
        document.body.classList.remove("bot-responding");
      });
      themeToggleButton.addEventListener('click', () => {
        const isLightTheme = document.body.classList.toggle('light-theme');
        localStorage.setItem('themeColor', isLightTheme ? 'light_mode' : 'dark_mode');
        themeToggleButton.textContent = isLightTheme ? 'dark_mode' : 'light_mode';
      });
      document.querySelectorAll('.suggestions-item').forEach((suggestion) => {
        suggestion.addEventListener('click', () => {
          promptInput.value = suggestion.querySelector('.text').textContent;
          promptForm.dispatchEvent(new Event('submit'));
        });
      });
      document.addEventListener('click', ({
        target
      }) => {
        const wrapper = document.querySelector('.prompt-wrapper');
        const shouldHide = target.classList.contains('prompt-input') || (wrapper.classList.contains('hide-controls') && (target.id === 'add-file-button' || target.id === 'stop-response-button'));
        wrapper.classList.toggle("hide-controls", shouldHide);
      });
      promptForm.querySelector('#add-file-button').addEventListener('click', () => fileInput.click());
      // Lade den Chat-Verlauf beim Seitenaufruf:
      window.addEventListener('load', loadChatHistory);
      //window.addEventListener('DOMContentLoaded', () => { 
      //document.querySelector(".fulls-chats-button").onclick = () => {  }
      //} )
    </script>


    </div>

<!--XXXXXX tickets2 XXXXXXXX -->

     <div class="tab" id="tickets2">
  	 <div id="speech-notes-dom">
     <!--  ### SPEECH-NotesStart -->

 <link rel="stylesheet" href="scss/speech-notes-style.css" id="speech-notes-style">

   <!-- <button class="close-button" style="border-radius: 100%; position: absolute; top:0; left:0;" onclick="document.querySelector('.inpB').click();">‚úñ</button>-->

    <div class="containerX speenotesbody">
      <div class="app">
          <div class="input-single">
            <textarea id="note-textarea" class="notetextarea" placeholder="Nachricht tippen und/oder einsprechen" rows="1"></textarea>
         </div>

        <button id="start-record-btn" title="Start Recording"> üé§ </button>
        <button id="pause-record-btn" title="Pause Recording"> ‚è∏ </button>
        <button id="save-note-btn" class="savenotebtn" title="Save Note"> üíæ </button>

        <p id="recording-instructions"> </p>

        <ul id="containery">
          <li> freey </li>
        </ul>

        <ul id="notes">
          <li>
            <p class="no-notes">Keine Nachricht/Notiz</p>
          </li>
        </ul>

    </div>
   </div>
  </div>	
     </div>

<!--XXXXXXX tickets XXXXXXX-->

    <div class="tab" id="tickets">

     <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 120 120%22><text y=%22.9em%22 font-size=%2290%22>‚ú®</text></svg>" />

  <style id="webdictaphoneStyle">
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      max-height: 100%;
max-width:800px;
      overflow: hidden;
    }

    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 0.8rem;
    }

    .wrapper {
      margin-left: 5px;
      max-height: 50%;
      display: flex;
      flex-direction: column;
      z-index: 3;
    }

    h1,
    h2 {
      font-size: 2rem;
      text-align: center;
      font-weight: normal;
      padding: 0.5rem 0 0 0;
    }

    .main-controls {
      padding: 0.5rem 0;
    }

    canvas {
      display: block;
      margin-bottom: 0.5rem;
    }

    #buttons {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    }

    #buttons button {
      font-size: 0.9rem;
      padding: 0.5rem;
      width: calc(50% - 0.25rem);
    }

    button {
      font-size: 1rem;
      background: #0088cc;
      text-align: center;
      color: white;
      border: none;
      transition: all 0.2s;
      padding: 0.4rem;
    }

    .close-button {
      display: block;
      position: fixed;
      left: 0;
      top: 0;
      background-color: lightblue;
      border-style: 3px solid black;
      color: black;
      border-radius: 10px;
      font-size: 1.1rem;
      margin-left: 0.3rem;
    }

    button:hover,
    button:focus {
      box-shadow: inset 0px 0px 10px rgba(255, 255, 255, 1);
      background: #0ae;
    }

    button:active {
      box-shadow: inset 0px 0px 20px rgba(0, 0, 0, 0.5);
      transform: translateY(2px);
    }

    /* Make the clips use as much space as possible, and
    * also show a scrollbar when there are too many clips to show
    * in the available space */
    .sound-clips {
      flex: 1;
      overflow: auto;
      border-bottom: 1px dotted black;
    }

    section,
    article {
      display: block;
    }

    .clip {
      padding-bottom: 1rem;
    }

    audio {
      width: 100%;
      display: block;
      margin: 1rem auto 0.5rem;
    }

    .clip p {
      display: inline-block;
      font-size: 1rem;
    }

    .clip button {
      font-size: 1rem;
      float: right;
    }

    button.delete {
      background: #f00;
      padding: 0.5rem 0.75rem;
      font-size: 0.8rem;
    }

    button.startwavai {
      background: blue;
      padding: 0.5rem 0.75rem;
      font-size: 0.8rem;
    }

    button.savewavai {
      background: blue;
      padding: 0.5rem 0.75rem;
      font-size: 0.8rem;
    }

    button.avewavai {
      background: blue;
      padding: 0.5rem 0.75rem;
      font-size: 0.8rem;
    }

    button.activewav {
      border: 3px solid green;
    }

    /* Checkbox hack to control information box display */
    label.labela {
      font-size: 2rem;
      position: absolute;
      top: 2px;
      right: 3px;
      cursor: pointer;
      background-color: black;
      opacity: 0.8;
      border-radius: 10px;
    }

    input[type="checkbox"].labela {
      position: absolute;
      top: -100px;
    }

    aside {
      position: fixed;
      z-index: 10;
      top: 0;
      left: 0;
      width: 100%;
      height: 80%;
      transform: translateX(100%);
      transition: 0.3s all ease-out;
      background-color: #efefef;
      padding: 1rem;
    }

    aside p {
      font-size: 1.2rem;
      margin: 0.5rem 0;
    }

    aside a {
      color: #666;
    }

    /* Toggled State of information box */
    input[type="checkbox"].labela:checked~aside {
      transform: translateX(0);
    }

    /// bside modal
    label.labelb {
      font-size: 2.5rem;
      position: fixed;
      top: 2px;
      left: 3px;
      cursor: pointer;
      background-color: black;
      opacity: 0.5;
      border-radius: 10px;
    }

    input[type="checkbox"].labelb {
      position: fixed;
      top: -100px;
    }

    bside {
      z-index: 5;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transform: translateX(100%);
      transition: 0.3s all ease-out;
      background-color: #efefef;
      padding: 1rem;
    }

    aside p {
      font-size: 1.2rem;
      margin: 0.5rem 0;
    }

    bside a {
      color: #666;
    }

    /* Toggled State of information box */
    input[type="checkbox"].labelb:checked~bside {
      transform: translateX(0);
    }

    ///
    /* Cursor when clip name is clicked over */
    .clip p {
      cursor: pointer;
    }

    /* Adjustments for wider screens */
    @media all and (min-width: 800px) {

      /* Don't take all the space as readability is lost when line length
        goes past a certain size */
      .wrapper {
        width: 90%;
        max-width: 1000px;
        margin: 0 auto;
      }
    }
  </style>




  <div class="wrapper">
    <header style="margin-bottom:25px;">
       <button style="position: absolute;left:10%;top:43px;border-radius:15px;padding:3px;" onclick="document.querySelector('.main-controls').classList.toggle('hide');dictApp();">üé§‚ñ∂wav‚ñ∂ChatAI</button>
<button style="position: absolute;right:10%;top:43px;border-radius:15px;padding:3px;padding-top:0;padding-bottom:1px;" onclick="document.querySelector('#modulStaticlnk2').click();">üé§‚ñ∂tts‚ñ∂staticAI<input type="checkbox" id="modulStaticlnk2" style="height:1rem;width:1rem;margin-top:5px;" onchange="let tpag = document.getElementById('contaskbing'); let zeval = document.querySelector('#appmoarray0');if(zeval.innerText == '1') {zeval.innerText='0';tpag.childNodes[1].classList.toggle('hide'); tpag.childNodes[7].classList.toggle('hide');tpag.childNodes[10].classList.toggle('hide');tpag.childNodes[12].classList.toggle('hide');} else {zeval.innerText='1';tpag.childNodes[1].classList.toggle('hide');tpag.childNodes[7].classList.toggle('hide');tpag.childNodes[10].classList.toggle('hide');tpag.childNodes[12].classList.toggle('hide');}"></button>
     </header>
<iframe src="miniapps/user-prompt-manager.html" id="prompt-manager-iframe" width="100%" height="400px" style="margin:0;border:none;padding:0;" frameborder="0" allow="camera *; microphone *; geolocation *; battery *; midi *; vr *; xr *; gyroscope *; accelerometer *; usb *; hid *; serial *; gamepad *; picture-in-picture *; display-capture *; keyboard-map *; magnetometer *; ambient-light-sensor *; payment *; screen-wake-lock *; sync-xhr *; clipboard-read *; clipboard-write *; fullscreen *; encrypted-media *; autoplay *; web-share *; compute-pressure *; local-fonts *; attribution-reporting *; interest-cohort *; publickey-credentials-get *; identity-credentials-get *; storage-access *" sandbox="allow-downloads allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-top-navigation allow-top-navigation-by-user-activation allow-storage-access-by-user-activation"> </iframe>
    <section class="main-controls hide">
      <canvas class="visualizer" height="60px"></canvas>
      <div id="buttons"> 
        <button class="record">üé§Record</button>
        <button class="stop">üé§Stop</button>
      </div>
    </section>
    <section class="sound-clips">
    </section>
   </div>
  <!--
   <label class="labelb toggB hide" for="toggleB">|bside|</label>
  <input class="labelb inpB hide" type="checkbox" id="toggleB">
   <label class="labela toggA" for="toggle">‚ú®</label>
  <input class="labela inpA" type="checkbox" id="toggle">
    -->
 
 <aside> aside modal tag‚úñ
  </aside>

  <!--style id=sizedisplay-style-->
 <link rel="stylesheet" href="scss/sizedisplay-style.css" id="sizedisplay-style">

  <!--  #### script id="sizedisplay-script" ###  -->
    
<style id="askbing3Style">
    #contaskbing {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 0.8rem;
      text-align: center;
    }

    #contaskbing #textareaspee {
      width: 85%;
      border: 1px solid #555;
      padding: 5px;
      margin: 0 0 5px;
      font-size: 110%;
    }

    #contaskbing h4 {
      margin: 1em 0 0;
    }

    button[data-permission] {
      position: relative;
      padding: 2px 3px 3px 30px;
      background: #666;
      border: 1px solid #333;
      border-radius: 5px;
      font-size: 100%;
      color: #fff;
      cursor: pointer;
      text-align: left;
    }

    button[data-permission]:before {
      content: '...';
      position: absolute;
      left: 5px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 120%;
      text-shadow: 0 0 1px rgba(0, 0, 0, 0.5);
    }

    button[data-permission][data-state="granted"] {
      background: #495;
      border-color: #051;
    }

    button[data-permission][data-state="granted"]:before {
      content: '\2705';
    }

    button[data-permission][data-state="denied"] {
      background: #945;
      border-color: #501;
    }

    button[data-permission][data-state="denied"]:before,
    button[data-permission][disabled]:before {
      content: '\1f6ab';
    }

    button[data-permission][data-state="unavailable"] {
      background: #886a33;
      border-color: #493b21;
      opacity: .7;
    }

    button[data-permission][data-state="unavailable"]:before {
      content: '\1f47b';
    }

    .ailinklist {
      text-align: center;
      background: transparent;
      list-style: none;
      padding: 5px;
      width: 95%;
      columns: 4;
      column-gap: 20px;
      margin-left: 1rem;
    }

    .ailinklist>li {
      background: lightblue;
      margin-left: 10px;
      margin-bottom: 10px;
      break-inside: avoid;
      border: 1px solid blue;
      padding: 5px;
      marging-bottom: 5px;
      overflow: hidden;
    }
    #button {
    background:red;
    color:black;
    }
  </style>
  <br><br>
  <div id="contaskbing" class="askbing3">
    <div class="hide" style="position: relative;"><textarea onblur="makeBingLnk(this.value)" id="textareaspee" placeholder="Text zur weiteren Verwendung" rows="2"></textarea>
      <button style="position: absolute; left:89%; top:-26px; background: transparent;" class="cleannotebtn" onclick="try {document.getElementById('note-textarea').value = ''; document.getElementById('textareaspee').value = ''; } catch(f) {}">‚ùå</button> <button class="savenotebtn" style="position: absolute; left:85%; top:-26px; border-radius:100%; background:transparent;" onclick="try {document.getElementById('note-textarea').value = document.getElementById('textareaspee').value;document.getElementById('textareaspee').focus(); document.getElementById('save-note-btn').click()} catch(f) {}">üíæ</button>
 <button id="copy"  style="position: absolute; left:79%; top:-26px; border-radius:100%; background:transparent;" onclick="try {document.getElementById('note-textarea').value = document.getElementById('textareaspee').value;document.getElementById('textareaspee').focus(); document.getElementById('save-note-btn').click()} catch(f) {}">üíï</button> <button id="paste"  style="position: absolute; left:74%; top:-26px; border-radius:100%; background:transparent;" onclick="try {document.getElementById('note-textarea').value = document.getElementById('textareaspee').value;document.getElementById('textareaspee').focus(); document.getElementById('save-note-btn').click()} catch(f) {}">üíò</button>
    <div> <button id="button" onclick="toggleStartStop()">tog?</button> </div>
    </div>

    <script id="askbing3ScriptA" class="askbing3" type="text/javascript">
      // main textarea of askbing3
      const textareax = document.getElementById("textareaspee");
      var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      var recognizing;
      var recognition = new SpeechRecognition();
      recognition.continuous = true;
      resetSpeech();
      recognition.onend = resetSpeech;
      recognition.onresult = function(event) {
        console.log("speeh recog result in textareaspee var");
        for (var i = event.resultIndex; i < event.results.length; ++i) {
          if (event.results[i].isFinal) {
            textareax.value += event.results[i][0].transcript;
          }
        }
      }

      function resetSpeech() {
        recognizing = false;
        button.innerHTML = "";
        button.style.marginTop = "12px";
        button.style.margin = "2px";
        button.style.paddingTop = "3px";
        button.style.paddingBottom = "3px";
        button.style.paddingLeft = "5px";
        button.style.paddingRight = "10px";
        button.style.borderRadius = "15% 15% 2px 2px";
    //    button.style.display = "none";
      }

      function toggleStartStop() {
        if (recognizing) {
          recognition.stop();
          resetSpeech();
        } else {
          recognition.start();
          recognizing = true;
button.style.display = "grid";
          button.innerHTML = "Stop recording / listening! ";
        }
      }
      
    </script>

    <div id="output" class="output"> 
    </div>
     <div id="content" class="hide">
      <textarea style="display: none; " id="out" rows="3" placeholder="Text to copy"></textarea>
      <div>
        <button id="textts" onclick="if(!button){return};button.click()">üé§‚ñ∂üìù</button>
        <button id="leser">üìù‚ñ∂üí¨</button>
        <button onclick="speechSynthesis.cancel()" id="lesencancel">üí¨‚ñ∂stop</button>
      </div>

    </div><br>
     <p class="hide">static Links external Window:<button style="font-size:0.8rem;background:transparent;padding:1px;" onclick="document.querySelector('#aistatic_lnk').innerText=' ... '"> ‚ùå</button></p>
     <div class="hide" id="aistatic_lnk"> ... </div>
    <br> 
    <div id="status"></div>
    <pre id="log"></pre>
  </div>

  <script id="askbing3ScriptB" class="askbing3">

    const vorleser = (text) => {
      speechSynthesis.speak(new SpeechSynthesisUtterance(text));
    };

    const ailink = document.getElementById("aistatic_lnk");
    const bingAI2link = (text, baseurl) => {
      return (
        '<a class="button" href="' +
        baseurl +
        encodeURIComponent(text) +
        '" target="_blank">' +
        baseurl.substring(8, 22).split('/')[0].replace('www.', '') +
        ' √∂ffnen</a>'
      );
    };
    /// URL LINK Extern AI Query
    function makeBingLnk(text) {
      if (!text) {
        return
      }
      // Copilot ChatGPT Grok
      const baseurlBing = "https://www.bing.com/search?showconv=1&sendquery=1&q=";
      const baseurlGpt = "https://chatgpt.com/?model=auto&q=";
      const baseurlGrok = "https://grok.com/?q=";
      const baseurlMistr = "https://chat.mistral.ai/chat?q=";
      //*Bing-copilot, openAI GPT, x-Grok, Mistral
      ailink.innerHTML = "<ul id='aiulistid' class='ailinklist'>" +
        "<li>" + bingAI2link(text, baseurlBing) + "</li>" +
        "<li>" + bingAI2link(text, baseurlGpt) + "</li>" +
        "<li>" + bingAI2link(text, baseurlGrok) + "</li>" +
        "<li>" + bingAI2link(text, baseurlMistr) + "</li>" +
        "</ul>";
    }
    /// clipboardfun
    /** Write contents of the textarea to the clipboard when clicking "Copy" */
    document.querySelector("#copy").addEventListener("click", () => {
      navigator.clipboard
        .writeText(textareax.value)
        .then(() => {
          console.log("Text copied.");
        })
        .catch(() => {
          console.log("Failed to copy text.");
        });
    });
    document.querySelector("#leser").addEventListener("click", () => {
      let vorlesetxt = textareax.value;
      vorleser(vorlesetxt);
    });
    /** Read from clipboard when clicking the Paste button */
    document.querySelector("#paste").addEventListener("click", () => {
      navigator.clipboard
        .readText()
        .then((text) => {
          textareax.value = text;
          console.log("Text pasted.");
        })
        .catch(() => {
          console.log("Failed to read from clipboard.");
        });
    });
    /** Watch for pastes */
    document.addEventListener("paste", (e) => {
      // e.preventDefault();
      navigator.clipboard.readText().then((text) => {
        console.log("Updated clipboard contents: " + text);
      });
    });
    /** Set up buttons to request permissions and display status: */
    document.querySelectorAll("[data-permission]").forEach((btn) => {
      const permission = btn.getAttribute("data-permission");
      navigator.permissions
        .query({
          name: permission
        })
        .then((status) => {
          status.onchange = () => {
            btn.setAttribute("data-state", status.state);
          };
          status.onchange();
        })
        .catch(() => {
          btn.setAttribute("data-state", "unavailable");
          btn.title = "Permissions API unavailable.";
        });
      btn.addEventListener("click", () => {
        Promise.resolve()
          .then(() => {
            return navigator.permissions.query({
              name: permission
            });
          })
          .then((status) => {
            console.log("Permission: " + status.state);
          })
          .catch((err) => {
            console.log("Permission request failed: " + err);
          });
      });
    });
</script>
    

<!-- ## bside ENDE  SPEECH-Notes ENDE  ## -->

  <!-- DIV UNGEKL√ÑRT:TO DO -->
 </div> 

<!-- main class="tabs" ENDE -->
 </main>

<script src="js/speech-notes-script.js" id="speech-notes-script"></script>
<script src="js/lokal.js" id="lokal-script"></script>
<script src="js/offline-detector.js" id="offline-detector"></script>
<script src="js/fullscreen-handler.js" id="fullscreen-handler"></script>
<script src="js/sizedisplay-script.js" id="sizedisplay-script"></script> 
<script src="js/_regexpress-ragPrepper-modules_.js" id="regexpress-script"></script>
<!-- A. EMBED shrimp-recorder.js HERE -->
<script src="js/shrimp-recorder.js"></script>
<script>
const broadcast = new BroadcastChannel('count-channel');

// Listen to the response
broadcast.onmessage = (event) => {
  console.log('version: '+event.data.payload);
document.querySelector('#webappversion').textContent = 'version: '+event.data.payload;
};

// Send first request
broadcast.postMessage({
  type: 'GET_VERSION',
});

//document.querySelector("#voicememo").addEventListener("click", () => {document.querySelector("a[href='#tickets']").click();document.querySelector(".inpB").click();});
</script>
<script>
/**
* Initialisiert die PageTools und erstellt die Werkzeugleiste f√ºr das Speichern und Laden der Chat-History.
* @param {object} options - Konfiguration f√ºr die PageTools.
* @param {HTMLElement} options.parentElement - Das DOM-Element, in das die Werkzeugleiste eingef√ºgt wird. ACHTUNG: Muss vom User gesetzt werden!
* @param {string} [options.localStorageKey='chatHistoryA100'] - Der Schl√ºssel f√ºr die Chat-History im Local Storage.
*/

const initPageTools = (options) => {
const {
parentElement,
localStorageKey = document.querySelector('#username').value+'-'+document.querySelector('#versionls').value   
} = options;

if (!parentElement) {
console.error('pagetools.js: parentElement ist erforderlich!');
return;
}

const toolbar = document.createElement('div');
toolbar.style.marginTop = '10px';

const saveButton = document.createElement('button');
saveButton.textContent = 'Chat-History speichern';
saveButton.addEventListener('click', () => {
saveChatHistoryToFile(STORAGE_KEY);
});
toolbar.appendChild(saveButton);

const loadButton = document.createElement('button');
loadButton.textContent = 'Chat-History laden';
loadButton.addEventListener('click', () => {
loadChatHistoryFromFile(localStorageKey);
});
toolbar.appendChild(loadButton);

parentElement.appendChild(toolbar);

/**
* Speichert die Chat-History aus dem Local Storage in einer lokalen Datei.
* @param {string} localStorageKey - Der Schl√ºssel f√ºr die Chat-History im Local Storage.
*/
function saveChatHistoryToFile(localStorageKey) {
 
const mychatHistory = localStorage.getItem(STORAGE_KEY);
if (!mychatHistory) {
alert('Keine Chat-History zum Speichern gefunden.');
return;
}

const filename = `aichat-user_${new Date().toISOString().replace(/[:T]/g, '-').slice(0, 19)}.mychatHistory`;
const blob = new Blob([mychatHistory ], {
type: 'application/json'
});
const url = URL.createObjectURL(blob);

const a = document.createElement('a');
a.href = url;
a.download = filename;
document.body.appendChild(a); // Needed for Firefox
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
}

/**
* L√§dt die Chat-History aus einer lokalen Datei in den Local Storage und die HTML-Seite.
* @param {string} localStorageKey - Der Schl√ºssel f√ºr die Chat-History im Local Storage.
*/
function loadChatHistoryFromFile(localStorageKey) {
const input = document.createElement('input');
input.type = 'file';
input.accept = '.chathistory';

input.addEventListener('change', (event) => {
const file = event.target.files[0];
if (!file) {
return;
}

const reader = new FileReader();
reader.onload = (e) => {
try {
const chatHistory = e.target.result;
localStorage.setItem(localStorageKey, chatHistory);
// Zus√§tzlich zur Speicherung im Local Storage, lade die Chat-History in die HTML-Seite.
loadChatHistoryToPage(chatHistory, localStorageKey);
alert('Chat-History erfolgreich geladen.');
} catch (error) {
console.error('Fehler beim Laden der Chat-History:', error);
alert('Fehler beim Laden der Chat-History.');
}
};
reader.readAsText(file);
});

input.click();
}

/**
* L√§dt die Chat-History aus dem Local Storage und rendert sie auf der HTML-Seite.
* Diese Funktion geht davon aus, dass du bereits Zugriff auf das 'chatsContainer' Element hast.
* Passe den Selektor 'chatsContainer' an, falls dein HTML anders strukturiert ist.
* @param {string} chatHistory - Der Chat-History-String im JSON-Format.
* @param {string} localStorageKey - Der Schl√ºssel f√ºr die Chat-History im Local Storage.
*/
function loadChatHistoryToPage(chatHistory, localStorageKey) {
try {
const parsedHistory = JSON.parse(chatHistory);

// Stelle sicher, dass 'parsedHistory' ein Array ist.
if (!Array.isArray(parsedHistory)) {
console.error('Ung√ºltige Chat-History-Daten: Erwarte ein Array.');
alert('Ung√ºltige Chat-History-Daten.');
return;
}

const chatsContainer = document.querySelector('.chats-container');
if (!chatsContainer) {
console.error('chatsContainer Element nicht gefunden. Stelle sicher, dass das Element mit der Klasse "chats-container" existiert.');
alert('chatsContainer Element nicht gefunden.');
return;
}

// Leere den aktuellen Chat-Verlauf, bevor neue Nachrichten hinzugef√ºgt werden.
chatsContainer.innerHTML = '';

parsedHistory.forEach(chatItem => {
if (chatItem.role === 'user') {
const userMsgHTML = `<p class="message-text">${chatItem.parts[0].text}</p>`;
const userMsgDiv = createMessageElement(userMsgHTML, 'user-message');
chatsContainer.appendChild(userMsgDiv);
} else if (chatItem.role === 'model') {
const botMessageHTML = `<div class='message-maindiv'><span class='avatar'>‚ú®</span><code class='message-text'>${chatItem.parts[0].text}</code></div>`;
const botMessageDiv = createMessageElement(botMessageHTML, 'bot-message');
chatsContainer.appendChild(botMessageDiv);
}
});

// F√ºge die Klasse 'chats-active' zum Body hinzu, um die Chat-UI anzuzeigen.
document.body.classList.add('chats-active');

// Scrolle zum Ende des Chats, um die neuesten Nachrichten anzuzeigen.
scrollToBottom();

} catch (error) {
console.error('Fehler beim Parsen oder Anzeigen der Chat-History:', error);
alert('Fehler beim Parsen oder Anzeigen der Chat-History.');
}
}

/**
* Hilfsfunktion zum Erstellen von Nachrichtenelementen.
* @param {string} content - Der HTML-Inhalt der Nachricht.
* @param {...string} classes - Zus√§tzliche CSS-Klassen f√ºr das Nachrichtenelement.
* @returns {HTMLElement} Das erstellte Nachrichtenelement.
*/
function createMessageElement(content, ...classes) {
const div = document.createElement('div');
div.classList.add('message', ...classes);
div.innerHTML = content;
return div;
}

/**
* Hilfsfunktion zum Scrollen zum Ende des Chats.
*/
function scrollToBottom() {
const container = document.querySelector('.container');
container.scrollTo({
top: container.scrollHeight,
behavior: 'smooth'
});
}
};
quickParam("lsuser");
quickParam("lsmainkey");
// // // // // //
// URL xxxx.html?keygemini=xxxxxxxxx
// quickParam("keygemini");
// quickParam("lsuser");          //       lsuser=mgpc
// quickParam("lsmainkey");   //       lsmainkey=chatHistoryA100
//mgpc-chatHistoryA100>mgpc-chatHistoryA101 //  mgpc-chatHistoryB100 > mgpc-chatHistoryB101



function quickParam(qp) {
    if(!qp) {return;}
   var link_now = new URL(window.location.href);
    var r = link_now.searchParams.get(qp); 
  
    if (!r || r === '') { console.log('ende no para in url'); return };
 
    if(qp == 'keygemini') {
        console.log('#gemiapikey= ' + r);
        document.querySelector('#gemiapikey').value = r;
        API_KEY = r;
        API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${API_KEY}`;
       console.log('# API_URL = ' + API_URL);
     
    } else if (qp ==='lsuser') {
        console.log('param: lsuser= ' + r);
        document.querySelector('#username').value = r;      
       console.log('#username= ' + document.querySelector('#username').value)
       
    } else  if (qp === 'lsmainkey') {
        console.log('lsmainkey = ' + r);
        document.querySelector('#versionls').value = r;      
       console.log('#versionls = ' + document.querySelector('#versionls').value)
    } else  if (qp === 'setmodel') {
         console.log(' API_MODEL= ' + r);
         API_MODEL = r;
         document.querySelector('#model-select-option').textContent= API_MODEL;
         document.querySelector('#model-select-option').value= API_MODEL;
         API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${API_KEY}`;
         console.log('# API_URL mit API_MODEL = ' + API_URL);
     }
 }


quickParam('keygemini');
quickParam("lsuser");
quickParam("lsmainkey");
quickParam("setmodel");



let optionsin = {};
optionsin.parentElement = document.querySelector('#aifile-updown');
optionsin.localStorageKey =  document.querySelector('#username').value+'-'+document.querySelector('#versionls').value    
//'chatHistoryA100';
initPageTools(optionsin);

/////ai-gemini20flash8b.html?keygemini=AIzaSyC3_0ADKYP1xpZAZi5-a_C693fZ0Eu33EE&lsuser=mgpc&lsmainkey=chatHistoryB100

</script>
</body>
</html>